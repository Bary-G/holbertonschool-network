#!/usr/bin/env bash
# Configure an Ubuntu server with an additional local IP and safe hosts modifications

set -euo pipefail

backup_file="/etc/hosts.bak.$(date +%F-%H%M%S)"

cp /etc/hosts "$backup_file"

echo "Backup created at $backup_file"

if ! grep -Eq '^127\.0\.0\.1[[:space:]]+localhost(\s|$)' /etc/hosts; then
    printf "%s\n" "127.0.0.1   localhost" >> /etc/hosts
fi

if ! grep -Eq '^127\.0\.0\.2(\s|$)' /etc/hosts; then
    printf "%s\n" "127.0.0.2   localhost2" >> /etc/hosts
fi

if ! grep -Eq '^8\.8\.8\.8[[:space:]]+facebook\.com(\s|$)' /etc/hosts; then
    printf "%s\n" "8.8.8.8   facebook.com" >> /etc/hosts
fi

grep -E "localhost" /etc/hosts
